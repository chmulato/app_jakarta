<div align="center">

# üöÄ Projeto Java Web (Tomcat / WildFly) 
Sistema web Java (Jakarta EE) com autentica√ß√£o, deploy fl- **Corre√ß√£o autom√°tica:** Se `bcrypt` estiver faltando, o script instala automaticamente e revalida o hash.

### Verifica√ß√µes de Ambiente Detalhadas
- **Java/Maven:** Vers√µes m√≠nimas e disponibilidade de comandos
- **Docker:** Daemon ativo e containers PostgreSQL em execu√ß√£o
- **Banco de dados:** Conectividade e estrutura da tabela `usuarios`
- **Depend√™ncias Python:** Instala√ß√£o autom√°tica de pacotes cr√≠ticos (`bcrypt`, `psycopg2`, etc.)
- **Servidores:** Estrutura de diret√≥rios Tomcat/WildFly e arquivos de configura√ß√£o

### Scripts de Setup Detalhados

#### `setup.dev.py` - Setup Completo Python
Script principal para configura√ß√£o completa do ambiente Python:
```powershell
python setup.dev.py              # Setup completo com valida√ß√µes
python setup.dev.py --auto-fix   # Corre√ß√£o autom√°tica de problemas detectados
python setup.dev.py --only-check # Apenas valida√ß√£o (sem modifica√ß√µes)
```

**Funcionalidades:**
- Cria√ß√£o e configura√ß√£o de ambiente virtual Python
- Instala√ß√£o autom√°tica de depend√™ncias cr√≠ticas (`bcrypt`, `psycopg2-binary`, `colorama`, etc.)
- Valida√ß√£o completa de ambiente (Java, Maven, Docker, PostgreSQL)
- **Valida√ß√£o de hash BCrypt do admin** com detec√ß√£o autom√°tica de problemas
- Verifica√ß√£o de conectividade com banco de dados
- Relat√≥rios detalhados de status do ambiente

#### `setup-python.ps1` - Setup Focado Python (PowerShell)
Script PowerShell alternativo para setup mais leve:
```powershell
./setup-python.ps1         # Setup completo Python
./setup-python.ps1 -Force  # Recria ambiente virtual
./setup-python.ps1 -OnlyCheck # Apenas valida√ß√£o
```

**Funcionalidades:**
- Cria√ß√£o de ambiente virtual Python via PowerShell
- Instala√ß√£o autom√°tica de depend√™ncias Python cr√≠ticas
- Verifica√ß√£o de instala√ß√£o do Python e pip
- Integra√ß√£o com sistema de requirements.txt
- Valida√ß√£o de ambiente Python espec√≠fico

---

## üîß Vari√°veis de Ambiente (Overrides)mcat ou WildFly, automa√ß√£o via script Python e integra√ß√£o PostgreSQL.

</div>

---

## üìå Vis√£o Geral
Este reposit√≥rio re√∫ne:
1. C√≥digo da aplica√ß√£o (`meu-projeto-java`)
2. Automa√ß√£o de build/deploy via `main.py` (substitui scripts PowerShell isolados)
3. Infraestrutura de banco (PostgreSQL via Docker Compose)
4. Suporte a dois modelos de execu√ß√£o:
    - Tomcat (porta padr√£o configur√°vel, usamos 9090 para evitar conflito com WildFly 8080)
    - WildFly (porta HTTP 8080 e management 9990)

---

## üß± Tecnologias Principais
| Camada | Tecnologias |
|--------|-------------|
| Linguagem | Java 11+ |
| Plataforma | Jakarta Servlet 6 / Jakarta EE APIs necess√°rias |
| Build | Maven |
| Servidores | Apache Tomcat 10.1.35 / WildFly 37.0.1.Final |
| Banco | PostgreSQL (Docker) |
| Pool | HikariCP |
| Persist√™ncia | Hibernate ORM |
| View | JSP + JSTL + Bootstrap 5 |
| Cobertura | JaCoCo |

---

## üóÇÔ∏è Estrutura Simplificada
```
app_jakarta/
 ‚îú‚îÄ‚îÄ main.py                  # Script Python (menu + automa√ß√£o deploy/testes)
 ‚îú‚îÄ‚îÄ docker-compose.yml       # Servi√ßos (PostgreSQL)
 ‚îú‚îÄ‚îÄ server/
 ‚îÇ   ‚îú‚îÄ‚îÄ apache-tomcat-10.1.35/
 ‚îÇ   ‚îî‚îÄ‚îÄ wildfly-37.0.1.Final/
 ‚îú‚îÄ‚îÄ meu-projeto-java/
 ‚îÇ   ‚îú‚îÄ‚îÄ pom.xml
 ‚îÇ   ‚îî‚îÄ‚îÄ src/...
 ‚îî‚îÄ‚îÄ log/                     # Logs do script (maven_deploy.log)
```

---

## ‚úÖ Pr√©-requisitos
| Item | Vers√£o recomendada | Observa√ß√£o |
|------|--------------------|------------|
| Java (JDK) | 11+ | Necess√°rio `JAVA_HOME` ou detec√ß√£o autom√°tica |
| Maven | 3.8+ | Usado para build/test/deploy |
| Docker Desktop | Atual | Apenas se quiser PostgreSQL local via compose |
| PowerShell ou Bash | Qualquer | Execu√ß√£o de comandos auxiliares |
| Python | 3.10+ | Para usar `main.py` |

Teste r√°pido (PowerShell):
```powershell
java -version
mvn -version
python --version
docker --version
```

---

## ‚ö° Setup R√°pido (Automatizado)
Para preparar o ambiente (checagens + venv + depend√™ncias Python):
```powershell
# Setup completo (inclui verifica√ß√µes Java, Maven, Docker, banco)
./setup-dev.ps1            # Executa checagens e cria venv se necess√°rio
./setup-dev.ps1 -OnlyCheck # Apenas valida ambiente
./setup-dev.ps1 -Force     # Recria venv
./setup-dev.ps1 -SkipPython # Pula parte Python

# Apenas setup Python (alternativa mais leve e focada)
./setup-python.ps1         # Cria venv e instala depend√™ncias Python
./setup-python.ps1 -OnlyCheck # Apenas valida ambiente Python
./setup-python.ps1 -Force  # Recria venv
./setup-python.ps1 -Python python3 # Especifica execut√°vel Python
```
Ap√≥s execu√ß√£o bem-sucedida:
```powershell
.\.venv\Scripts\Activate.ps1
python .\main.py --only-check
```
Principais verifica√ß√µes: 
 - Java / Maven (vers√µes e disponibilidade)
 - Docker CLI + Docker daemon ativo (`docker info`)
 - Container PostgreSQL (nome contendo `postgres`)
 - WSL (presen√ßa de `wsl.exe` e distros registradas) em ambientes Windows
 - Perfis Maven esperados (`tomcat`, `wildfly`, `run`)
 - Virtualenv Python + libs (`requests`, `colorama`, `psutil`, `bcrypt`)
 - **Valida√ß√£o de hash do admin** (verifica integridade das credenciais padr√£o no banco)

**Funcionalidades avan√ßadas dos scripts de setup:**
- **Instala√ß√£o autom√°tica de depend√™ncias cr√≠ticas**: Scripts detectam e instalam automaticamente bibliotecas Python necess√°rias (como `bcrypt` para valida√ß√£o de hash)
- **Valida√ß√£o de ambiente completa**: Inclui verifica√ß√£o de conectividade com banco PostgreSQL e valida√ß√£o de hash das credenciais admin
- **Corre√ß√£o autom√°tica**: Op√ß√£o `--auto-fix` em `setup.dev.py` permite corre√ß√£o autom√°tica de problemas detectados

Se o Docker estiver instalado mas o daemon desligado: iniciar Docker Desktop e reexecutar `./setup-dev.ps1 -OnlyCheck`.
Se WSL n√£o estiver instalado e pretende usar backend WSL2 do Docker: `wsl --install` (requer reboot).

---

## ÔøΩ Valida√ß√£o de Ambiente
Os scripts de setup realizam valida√ß√£o completa do ambiente de desenvolvimento, incluindo verifica√ß√£o de conectividade com banco e integridade das credenciais.

### Valida√ß√£o de Hash do Admin
O script `setup.dev.py` inclui valida√ß√£o autom√°tica do hash BCrypt do usu√°rio admin padr√£o:
- **Status poss√≠veis:**
  - ‚úÖ **OK**: Hash v√°lido e corresponde √† senha padr√£o
  - ‚ùå **MISMATCH**: Hash n√£o corresponde (poss√≠vel altera√ß√£o manual)
  - ‚ö†Ô∏è **N/A**: Biblioteca `bcrypt` n√£o dispon√≠vel (ser√° instalada automaticamente)

- **Funcionamento:**
  ```powershell
  python setup.dev.py --auto-fix  # Executa valida√ß√£o completa com corre√ß√£o autom√°tica
  ```

- **Corre√ß√£o autom√°tica:** Se `bcrypt` estiver faltando, o script instala automaticamente e revalida o hash.

### Verifica√ß√µes de Ambiente Detalhadas
- **Java/Maven:** Vers√µes m√≠nimas e disponibilidade de comandos
- **Docker:** Daemon ativo e containers PostgreSQL em execu√ß√£o
- **Banco de dados:** Conectividade e estrutura da tabela `usuarios`
- **Depend√™ncias Python:** Instala√ß√£o autom√°tica de pacotes cr√≠ticos (`bcrypt`, `psycopg2`, etc.)
- **Servidores:** Estrutura de diret√≥rios Tomcat/WildFly e arquivos de configura√ß√£o

---

## ÔøΩüîß Vari√°veis de Ambiente (Overrides)
O script `main.py` aceita overrides para diret√≥rios dos servidores.

| Vari√°vel | Prop√≥sito | Exemplo |
|----------|----------|---------|
| `APP_TOMCAT_DIR` | Caminho alternativo do Tomcat | `C:\tools\tomcat10` |
| `APP_WILDFLY_DIR` | Caminho alternativo do WildFly | `D:\servers\wildfly-37` |

Tamb√©m √© poss√≠vel passar por argumentos CLI (preced√™ncia: argumento > vari√°vel > padr√£o).

| Argumento | Exemplo |
|-----------|---------|
| `--tomcat-dir` | `--tomcat-dir C:\custom\tomcat` |
| `--wildfly-dir` | `--wildfly-dir D:\wf` |
| `--only-check` | Apenas verifica ambiente e sai |

---

## üöÄ Uso R√°pido (Script Python)
Menu interativo:
```powershell
python .\main.py
```

Somente validar ambiente:
```powershell
python .\main.py --only-check
```

Com overrides de diret√≥rios:
```powershell
$env:APP_TOMCAT_DIR='C:\servers\tomcat10'; $env:APP_WILDFLY_DIR='C:\servers\wildfly37'; python .\main.py
# ou via argumentos
python .\main.py --tomcat-dir C:\servers\tomcat10 --wildfly-dir C:\servers\wildfly37
```

Logs: `log/maven_deploy.log`

> Nota: Scripts PowerShell legados na pasta `scr/` foram substitu√≠dos pelo fluxo central via `main.py` e ser√£o gradualmente removidos. Consulte `doc/DEPLOY.md` e `doc/ARQUITETURA.md` para detalhes atualizados.

---

## üåê Banco de Dados (PostgreSQL via Docker)
Subir servi√ßo:
```powershell
docker-compose up -d postgres
```
Verificar container:
```powershell
docker ps --filter "name=postgres"
```
Scripts de inicializa√ß√£o: `docker/postgres/init/*.sql`

---

## üîÑ Build & Testes
Build padr√£o:
```powershell
cd meu-projeto-java
mvn clean package -DskipTests
```
Testes com cobertura:
```powershell
mvn clean test verify
```
Via script Python (usa heur√≠sticas e log unificado):
```powershell
python .\main.py --only-check  # Verifica antes
```

---

## üì¶ Deploy no Tomcat
Op√ß√£o de menu: 2 (deploy) ou 3 (iniciar sem deploy).

Passos internos executados pelo script:
1. Verifica√ß√£o ambiente (Java/Maven)
2. `mvn clean package -Ptomcat -DskipTests`
3. Ajuste de porta em `conf/server.xml` (porta configurada = 9090 por padr√£o)
4. C√≥pia do WAR para `webapps/`
5. Inicializa√ß√£o (plugin Maven ou Tomcat standalone)

URL ap√≥s subida:
```
http://localhost:9090/MEU-CONTEXTO (ou conforme nome do WAR)
```

Alterar porta: editar constante `TOMCAT_PORT` em `main.py` (ou melhorar futuramente com argumento CLI se necess√°rio).

---

## üè¢ Deploy no WildFly
Op√ß√£o de menu: 4 (deploy) ou 5 (iniciar sem deploy).

Fluxo:
1. `mvn clean package -Pwildfly -DskipTests`
2. WAR enviado para `standalone/deployments`
3. Inicializa√ß√£o via plugin Maven ou `standalone.bat`

URLs:
```
Aplica√ß√£o: http://localhost:8080/<contexto>
Console Admin: http://localhost:9990/
```

Portas: alterar constantes `WILDFLY_PORT` e `WILDFLY_MANAGEMENT_PORT` em `main.py` (ou via ajuste de configura√ß√£o manual do servidor).

---

## üßπ Limpeza / Undeploy
Pelo menu: op√ß√£o 6.
Aciona fun√ß√£o `clean_all_deployments()` que remove:
- `target/`
- WARs em `webapps/` (Tomcat)
- Artefatos `deployments/` (WildFly)
- Diret√≥rios tempor√°rios (`tomcat.8080`, `tmp`)

---

## üõ†Ô∏è Diagn√≥stico
Op√ß√µes:
- 7: Diagn√≥stico Tomcat (logs + server.xml + vari√°veis)
- 8: Diagn√≥stico WildFly (logs + deployments + portas)

Scripts chamam fun√ß√µes: `diagnose_tomcat_issues()` e `diagnose_wildfly_issues()`.

---

## üß™ Perfis Maven
Perfis esperados no `pom.xml`:
| Perfil | Prop√≥sito |
|--------|----------|
| `tomcat` | Build para deploy em Tomcat |
| `wildfly` | Build alinhado √†s libs do WildFly |
| `run` | Execu√ß√£o com Tomcat embarcado / desenvolvimento r√°pido |

Exemplos:
```powershell
mvn clean package -Ptomcat -DskipTests
mvn clean package -Pwildfly -DskipTests
mvn -Prun
```

---

## üîç Troubleshooting Resumido
| Problema | A√ß√£o R√°pida |
|----------|-------------|
| Porta 8080 ou 9090 ocupada | `netstat -ano | findstr :8080` / `:9090` + `taskkill /PID <PID> /F` |
| Docker instalado mas inativo | Abrir Docker Desktop at√© √≠cone estabilizar, depois `./setup-dev.ps1 -OnlyCheck` |
| WSL ausente (precisa para Docker) | `wsl --install` e reiniciar; depois revalidar |
| Tomcat n√£o sobe | Ver `server/apache-tomcat-*/logs/` + op√ß√£o 7 diagn√≥stico |
| WildFly travando | `server/wildfly-*/standalone/log/server.log`; limpar `standalone/tmp` e `standalone/data` |
| WAR n√£o gerado | Conferir `mvn clean package -Ptomcat` sa√≠da e exist√™ncia de `target/*.war` |
| JDBC falha | Ver container postgres (`docker ps`) + credenciais em `persistence.xml` |
| JSTL erro URI | Usar URIs `jakarta.tags.*` e depend√™ncias JSTL 3.x |
| **AdminHash mostra N/A** | `python setup.dev.py --auto-fix` (instala bcrypt automaticamente) |
| **AdminHash mostra MISMATCH** | Verificar se senha do admin foi alterada no banco; reset se necess√°rio |

Material detalhado: ver `doc/TESTES-RELATORIO.md`, `doc/DEPLOY.md` e `doc/ARQUITETURA.md`.

---

## üîí Autentica√ß√£o (Resumo)
Fluxo simples baseado em tabela `usuarios` (ver scripts SQL iniciais). Expans√µes futuras: autoriza√ß√£o granular, recupera√ß√£o de senha e auditoria.

### üîê Credenciais Padr√£o (Primeiro Acesso)
Criadas pelo script `docker/postgres/init/01-init.sql` apenas quando o banco √© inicializado pela primeira vez ou n√£o existe nenhum ADMIN.

| Tipo | Email | Senha (texto) | Perfil | Observa√ß√µes |
|------|-------|---------------|--------|-------------|
| Admin Principal | `admin@meuapp.com` | `Admin@123` | ADMIN | Usu√°rio default documentado (hash BCrypt custo 10) |
| Admin Demo | `admin@exemplo.com` | `Admin@123` | ADMIN | Conta adicional de demonstra√ß√£o |
| Usu√°rio Demo 1 | `joao@exemplo.com` | `Admin@123` | USUARIO | Dados de exemplo |
| Usu√°rio Demo 2 | `maria@exemplo.com` | `Admin@123` | USUARIO | Dados de exemplo |

Avisos:
- Todas as contas usam o mesmo hash BCrypt para simplificar testes locais. N√ÉO reutilizar em produ√ß√£o.
- Altere a senha do `admin@meuapp.com` imediatamente em ambientes compartilhados.
- O bloco DO $$ √© idempotente (n√£o recria se j√° houver ADMIN).

Gerar novo hash (exemplo Python):
```python
import bcrypt; print(bcrypt.hashpw(b'NovaSenhaSegura!', bcrypt.gensalt(rounds=10)).decode())
```

Atualizar senha no banco:
```sql
UPDATE usuarios SET senha = '<NOVO_HASH_BCRYPT>' WHERE email = 'admin@meuapp.com';
```

### üåê P√°ginas e Rotas

| Rota | Arquivo / Origem | Perfil | Descri√ß√£o |
|------|------------------|--------|-----------|
| `/` | `index.jsp` | P√∫blico | Landing page / marketing |
| `/login` | `login.jsp` | P√∫blico | Autentica√ß√£o |
| `/dashboard` | `dashboard.jsp` | Autenticado | Painel principal |
| `/usuarios` | (Servlet) | ADMIN | Gest√£o de usu√°rios |
| `/produtos` | (Servlet) | ADMIN / USUARIO(leitura) | Gest√£o de produtos |
| `/relatorios` | (Servlet) | ADMIN | Relat√≥rios e m√©tricas |
| `/configuracoes` | (Servlet) | ADMIN | Configura√ß√µes administrativas |
| `/logout` | (Servlet) | Autenticado | Encerra sess√£o |
| `/test.jsp` | `test.jsp` | P√∫blico | Verifica√ß√£o b√°sica do container |

Rotas sugeridas futuras: `/api/*`, `/health`, `/actuator/*` (se adicionar camada REST / observabilidade).

---

## üìÅ Estrutura (Detalhada)
Para vis√£o mais completa ver pasta `doc/`. Resumo principal permanece condizente com automa√ß√£o Python.

---

## ‚ôªÔ∏è Pr√≥ximas Melhorias Sugeridas
- Parametrizar portas via CLI (`--tomcat-port`, `--wildfly-port`)
- Adicionar coleta de m√©tricas b√°sicas (tempo de build, tamanho WAR)
- Exportar relat√≥rio de cobertura integrado (ler JaCoCo e sumarizar)
- Pipeline CI (GitHub Actions) com build + testes + deploy opcional

---

## üìÑ Licen√ßa
Uso interno / educacional. Definir licen√ßa formal se for p√∫blico.

---

## üôã Suporte
Abra uma issue descrevendo:
1. Passos executados
2. Sa√≠da relevante do log `log/maven_deploy.log`
3. Sistema operacional e vers√µes (Java/Maven)

---

> Documenta√ß√£o atualizada para refletir novo fluxo via `main.py`, overrides de diret√≥rios e diagn√≥stico unificado.

## üîë Funcionalidades Principais

- ‚úÖ **Login Seguro** - Autentica√ß√£o com email e senha
- ‚úÖ **Controle de Sess√£o** - Gerenciamento de usu√°rios logados
- ‚úÖ **Dashboard Administrativo** - Interface para usu√°rios autenticados
- ‚úÖ **Layout Responsivo** - Funciona em dispositivos m√≥veis e desktop

docker-compose up -d postgres
## üöÄ Execu√ß√£o (Atalho)
Use o menu Python (recomendado):
```powershell
python .\main.py
```
Deploy Tomcat direto:
```powershell
python .\main.py --only-check && mvn -f meu-projeto-java\pom.xml clean package -Ptomcat -DskipTests
```
Material comparativo e fluxo detalhado: ver `doc/DEPLOY.md`.

### Acessar a Aplica√ß√£o
- **URL**: http://localhost:8080/meu-projeto-java/
- **Login**: http://localhost:8080/meu-projeto-java/login
- **Credenciais (demo)**: admin@meuapp.com / Admin@123

## üß∞ Scripts Legados
Ainda existem scripts PowerShell em `scr/`, por√©m a estrat√©gia oficial √© centralizar via `main.py`. Scripts legados ser√£o revisados ou removidos em etapas futuras. Consulte `doc/REFATORACAO.md` para hist√≥rico.

## üîç Solu√ß√£o de Problemas (Detalhada)

### Problemas com Servidor Tomcat

1. **Porta 8080 j√° est√° em uso**
   ```
   Error: listen EADDRINUSE: address already in use 0.0.0.0:8080
   ```
   **Solu√ß√£o**: Verifique se outro processo est√° usando a porta 8080 (WildFly, outro Tomcat, etc.)
   ```powershell
   # Encontrar processos usando a porta 8080
   netstat -ano | findstr :8080
   
   # Encerrar o processo por ID (substitua {PID} pelo ID do processo)
   taskkill /F /PID {PID}
   ```

2. **Tomcat n√£o consegue iniciar a aplica√ß√£o**
   - Verifique o log em `meu-projeto-java/logs/application.log`
   - Verifique se existe o diret√≥rio webapp: `meu-projeto-java/src/main/webapp`
   - Verifique se as depend√™ncias est√£o corretas: `mvn dependency:tree`

3. **Classe WebServer n√£o encontrada**
   - Execute o script `.\scr\tomcat\iniciar-tomcat.ps1` que compila e inicia automaticamente
   - Verifique se `WebServer.java` existe em `meu-projeto-java/src/main/java/com/exemplo/config/`

### Problemas com Servidor WildFly

1. **Erro ao iniciar WildFly**
   ```
   WFLYSRV0055: Caught exception during boot: org.jboss.as.controller.persistence.ConfigurationPersistenceException
   ```
   **Solu√ß√£o**: Restaurar arquivo de configura√ß√£o do backup
   ```powershell
   # Restaurar o backup da configura√ß√£o
   Copy-Item -Path "C:\dev\workspace\wildfly\standalone\configuration\standalone.xml.bak" -Destination "C:\dev\workspace\wildfly\standalone\configuration\standalone.xml" -Force
   ```

2. **Problemas com implanta√ß√£o no WildFly**
   ```
   WFLYUT0105: Host and context path are occupied
   ```
   **Solu√ß√£o**: Limpar diret√≥rios de implanta√ß√£o e cache do WildFly
   ```powershell
   # Limpar deployments e cache
   Remove-Item -Path "C:\dev\workspace\wildfly\standalone\deployments\*" -Force
   Remove-Item -Path "C:\dev\workspace\wildfly\standalone\data\content\*" -Recurse -Force
   ```

3. **Configura√ß√£o de datasource do WildFly inv√°lida**
   ```
   IJ010061: Unexpected element: user
   ```
   **Solu√ß√£o**: Reconfigurar o datasource PostgreSQL para WildFly
   ```powershell
   # Reconfigurar datasource
   .\scr\wildfly\configurar-wildfly-bd.ps1
   ```

4. **WildFly n√£o aparece no navegador**
   - Verifique se o processo est√° em execu√ß√£o: `Get-Process -Name java`
   - Verifique os logs: `Get-Content -Path "C:\dev\workspace\wildfly\standalone\log\server.log" -Tail 50`
   - Reinicie o servidor: `& "C:\dev\workspace\wildfly\bin\standalone.bat"`

### Problemas JSTL com Jakarta EE
Se encontrar erros como "Unable to load tag handler class org.apache.taglibs.standard.tag.rt.core.IfTag", verifique:
- Os URIs nos arquivos JSP devem usar `jakarta.tags.core` em vez de `http://java.sun.com/jsp/jstl/core`
- As depend√™ncias no pom.xml devem incluir `jakarta.servlet.jsp.jstl-api` e `jakarta.servlet.jsp.jstl`

```xml
<!-- JSTL para JSP (Jakarta EE) -->
<dependency>
    <groupId>jakarta.servlet.jsp.jstl</groupId>
    <artifactId>jakarta.servlet.jsp.jstl-api</artifactId>
    <version>3.0.0</version>
</dependency>
<dependency>
    <groupId>org.glassfish.web</groupId>
    <artifactId>jakarta.servlet.jsp.jstl</artifactId>
    <version>3.0.1</version>
</dependency>
```

### Problemas de Conex√£o com Banco de Dados
Para solucionar problemas de conex√£o com PostgreSQL:
1. Verifique se o cont√™iner Docker est√° rodando: `docker ps`
2. Verifique a configura√ß√£o HikariCP no JPAUtil.java
3. Confirme as credenciais corretas em persistence.xml
4. Execute: `.\scr\atualizar-banco-dados.ps1` para corrigir a estrutura do banco

### Problemas de Autentica√ß√£o
Se o login n√£o estiver funcionando:
1. Verifique se a coluna 'perfil' existe na tabela 'usuarios'
2. Confirme que as senhas est√£o armazenadas no formato correto
3. Execute: `.\scr\atualizar-senhas-db.ps1` para atualizar as senhas

## üìã Estrutura do Banco de Dados (Resumo)

### Tabela de Usu√°rios
```sql
CREATE TABLE usuarios (
    id SERIAL PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    email VARCHAR(150) UNIQUE NOT NULL,
    senha VARCHAR(255) NOT NULL,
    ativo BOOLEAN DEFAULT true,
    perfil VARCHAR(20) DEFAULT 'USUARIO' CHECK (perfil IN ('ADMIN', 'USUARIO')),
    data_criacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    data_atualizacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### Dados de Exemplo (Legado Simplificado)
O script atual usa hash BCrypt; abaixo apenas exemplo did√°tico (N√ÉO condiz com o ambiente real pois l√° as senhas est√£o cifradas):
```sql
-- Exemplo ilustrativo (n√£o executado no init atual)
INSERT INTO usuarios (nome, email, senha, perfil) VALUES ('Admin Teste', 'admin@meuapp.com', 'Admin@123', 'ADMIN');
```

## üèóÔ∏è Estrutura do Projeto (Simplificada)

```
workspace/
‚îú‚îÄ‚îÄ menu.ps1              # Menu principal da aplica√ß√£o
‚îú‚îÄ‚îÄ README.md             # Documenta√ß√£o do projeto
‚îú‚îÄ‚îÄ docker-compose.yml    # Configura√ß√£o do Docker
‚îú‚îÄ‚îÄ scr/                  # Scripts utilit√°rios
‚îÇ   ‚îú‚îÄ‚îÄ README.md         # Documenta√ß√£o dos scripts
‚îÇ   ‚îú‚îÄ‚îÄ tomcat/           # Scripts para Tomcat
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deploy-tomcat.ps1          # Implanta√ß√£o no Tomcat
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ iniciar-tomcat.ps1         # Iniciar Tomcat
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ testar-aplicacao-completa.ps1  # Testes
‚îÇ   ‚îú‚îÄ‚îÄ wildfly/          # Scripts para WildFly
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ adaptar-para-wildfly.ps1   # Adaptar para WildFly
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ configurar-wildfly-bd.ps1  # Configurar BD
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ deploy-wildfly.ps1         # Implantar no WildFly
‚îÇ   ‚îî‚îÄ‚îÄ ...               # Outros scripts utilit√°rios
‚îú‚îÄ‚îÄ docker/               # Configura√ß√µes Docker
‚îÇ   ‚îî‚îÄ‚îÄ postgres/
‚îÇ       ‚îî‚îÄ‚îÄ init/         # Scripts de inicializa√ß√£o do banco
‚îú‚îÄ‚îÄ wildfly/              # Servidor WildFly (Produ√ß√£o)
‚îÇ   ‚îú‚îÄ‚îÄ bin/              # Scripts de execu√ß√£o
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ standalone.bat    # Iniciar WildFly (modo standalone)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ jboss-cli.bat     # Cliente de linha de comando
‚îÇ   ‚îú‚îÄ‚îÄ standalone/       # Configura√ß√£o standalone
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ configuration/    # Arquivos de configura√ß√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ standalone.xml    # Configura√ß√£o principal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deployments/      # Diret√≥rio de implanta√ß√£o
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ log/              # Logs do servidor
‚îÇ   ‚îî‚îÄ‚îÄ ...               # Outras pastas do WildFly
‚îú‚îÄ‚îÄ meu-projeto-java/     # C√≥digo-fonte da aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ java/com/exemplo/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/     # Configura√ß√µes do sistema
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ WebServer.java.bak   # Configura√ß√£o Tomcat (backup)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dao/        # Objetos de acesso a dados
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ model/      # Entidades JPA
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ servlet/    # Servlets para web
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ resources/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ META-INF/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ persistence.xml # Configura√ß√£o JPA
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ webapp/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ WEB-INF/
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ web.xml     # Configura√ß√£o web
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ index.jsp       # P√°gina inicial
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ login.jsp       # P√°gina de login
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ dashboard.jsp   # Dashboard ap√≥s login
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ test/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ java/com/exemplo/   # Testes unit√°rios
‚îÇ   ‚îî‚îÄ‚îÄ pom.xml           # Configura√ß√£o Maven
‚îú‚îÄ‚îÄ tomcat.8080/          # Diret√≥rio de trabalho do Tomcat (Desenvolvimento)
‚îÇ   ‚îî‚îÄ‚îÄ work/            # Arquivos tempor√°rios do Tomcat
‚îî‚îÄ‚îÄ logs/                 # Logs da aplica√ß√£o
    ‚îî‚îÄ‚îÄ application.log   # Log principal da aplica√ß√£o
```

## üîÑ Atualiza√ß√µes Recentes

1. **Reorganiza√ß√£o de Scripts** - Estrutura mais organizada com scripts em diret√≥rios espec√≠ficos por fun√ß√£o
2. **Integra√ß√£o com WildFly** - Suporte completo para implanta√ß√£o no servidor WildFly 37.0.1.Final
3. **Verifica√ß√£o Autom√°tica do PostgreSQL** - Valida√ß√£o do banco de dados no Docker antes da implanta√ß√£o
4. **Configura√ß√£o Automatizada do WildFly** - Script para configurar datasource no WildFly
5. **Corre√ß√£o JSTL** - Atualiza√ß√£o para compatibilidade com Jakarta EE
6. **Integra√ß√£o HikariCP** - Melhoria no gerenciamento de conex√µes
7. **Corre√ß√£o de Login** - Aprimoramento no sistema de autentica√ß√£o
8. **Atualiza√ß√£o de Banco** - Adi√ß√£o da coluna 'perfil' para usu√°rios
9. **Menu Principal** - Menu centralizado com acesso a todas as funcionalidades
10. **Corre√ß√£o de Depend√™ncias Hibernate** - Adi√ß√£o das depend√™ncias hibernate-commons-annotations para WildFly
11. **Melhoria do Script Python** - Melhorias de diagn√≥stico e configura√ß√£o de ambiente para Tomcat e WildFly
12. **Documenta√ß√£o Detalhada** - Adi√ß√£o de [documenta√ß√£o espec√≠fica](scr/README.md) para os scripts utilit√°rios

## ÔøΩ Documenta√ß√£o Adicional

Para facilitar o desenvolvimento e manuten√ß√£o, este projeto inclui documenta√ß√£o detalhada:

- **[Documenta√ß√£o dos Scripts](scr/README.md)** - Descri√ß√£o completa de todos os scripts utilit√°rios, incluindo:
  - Finalidade e funcionalidade de cada script
  - Par√¢metros e op√ß√µes dispon√≠veis
  - Exemplos de uso e casos comuns
  - Fluxos de trabalho recomendados

Esta documenta√ß√£o ajuda a entender como utilizar corretamente cada ferramenta dispon√≠vel no projeto e como elas se integram para facilitar o desenvolvimento, testes e manuten√ß√£o da aplica√ß√£o.

## üîÑ Migra√ß√£o entre Servidores (Resumo)

Este projeto suporta tanto Tomcat quanto WildFly, mas a migra√ß√£o entre eles requer algumas considera√ß√µes:

### Migrando de Tomcat para WildFly

1. **Adaptar depend√™ncias**:
   - Execute `.\scr\wildfly\adaptar-para-wildfly.ps1` para atualizar as depend√™ncias
   - Verifique se o namespace das importa√ß√µes foi atualizado de `javax.*` para `jakarta.*`

2. **Configurar datasource**:
   - Configura√ß√£o do datasource no WildFly √© diferente do Tomcat
   - Execute `.\scr\wildfly\configurar-wildfly-bd.ps1` para configurar

3. **Ajustar web.xml**:
   - Para WildFly, o `web.xml` precisa usar esquema Jakarta EE
   ```xml
   <web-app xmlns="https://jakarta.ee/xml/ns/jakartaee"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="https://jakarta.ee/xml/ns/jakartaee https://jakarta.ee/xml/ns/jakartaee/web-app_5_0.xsd"
          version="5.0">
   ```

4. **Implanta√ß√£o**:
   - Use `.\scr\wildfly\deploy-wildfly.ps1` para compilar e implantar no WildFly

### Migrando de WildFly para Tomcat

1. **Adaptar depend√™ncias**:
   - Ajuste o `pom.xml` para usar depend√™ncias compat√≠veis com Tomcat
   - Para vers√µes mais antigas de Tomcat (< 10), volte para depend√™ncias `javax.*`

2. **Configurar datasource**:
   - Para Tomcat, use JNDI no arquivo `context.xml` ou configura√ß√£o direta
   - Ajuste `persistence.xml` se necess√°rio

3. **Ajustar web.xml**:
   - Para Tomcat < 10, volte para esquema JavaEE
   ```xml
   <web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
          version="4.0">
   ```

4. **Implanta√ß√£o**:
   - Use `.\scr\tomcat\deploy-tomcat.ps1` para compilar e implantar no Tomcat

## üìö Recursos Adicionais

- [Documenta√ß√£o do Tomcat](https://tomcat.apache.org/tomcat-10.0-doc/index.html)
- [Documenta√ß√£o do WildFly](https://docs.wildfly.org/27/)
- [Migra√ß√£o de JavaEE para JakartaEE](https://jakarta.ee/resources/JakartaEE-Datasheet-July2020_final.pdf)
- [Guia de migra√ß√£o Tomcat para WildFly](https://www.wildfly.org/news/2020/06/18/Jakarta-EE-Migration/)

## üìù Pr√≥ximos Passos

- [ ] Adicionar sistema de recupera√ß√£o de senha
- [ ] Implementar controle de acesso baseado em perfis
- [ ] Adicionar p√°ginas de gerenciamento de usu√°rios
- [ ] Expandir funcionalidades do dashboard

---

**Desenvolvido com ‚ù§Ô∏è usando Java Enterprise**
*√öltima atualiza√ß√£o: 17 de Setembro 2025*